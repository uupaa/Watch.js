var j=this.self||global;
function k(a,h,e){this.d=h||{};this.d.k&&console.log("  --- watch ---");a.forEach(function(a){if(p(a)){var b=0;console.log("    file    "+a);q.l(a,function(){b&&(clearTimeout(b),b=0);b=setTimeout(function(){clearTimeout(b);b=0;e(null,null)},2E3)})}else if(q.e(a)&&q.c(a).isDirectory()){var f=function(){c&&(clearTimeout(c),c=0);c=setTimeout(function(){var b=s(a,h),g=d,f={},m;for(m in b.files){var l;a:{l=b.files[m];var r=g.files[m];if(l&&r){if(l.dir===r.dir&&l.size===r.size&&l.a===r.a){l=!0;break a}console.log("    "+
t+"changed "+u+m)}l=!1}l||(f[m]=b.files[m])}d=b;clearTimeout(c);c=0;e(null,f)},2E3)},c=0,d=s(a,h),g;for(g in d.b)console.log("    dir     "+g),q.watch(g,f)}})}function s(a,h){var e={b:{},files:{}},n=q.c(a),b=h.f||[],f=!1;n.isDirectory()&&(b.length&&(f=b.some(function(b){return p(a+b)})),f||(e.b[a]={dir:!0,size:n.size,a:+n.a},v(e,a,h)));return e}
function v(a,h,e){var n=q.j(h),b=e.f||[],f=e.h||[];w.i(n).forEach(function(c){var d=h+c;c=q.c(d);var g=!1;c.isFile()?(f.length&&(g=f.some(function(a){return d.lastIndexOf(a)===d.length-a.length})),g||(a.files[d]={dir:!1,size:c.size,a:+c.a})):c.isDirectory()&&(d+="/",b.length&&(g=b.some(function(a){return p(d+a)})),g||(a.b[d]={dir:!0,size:c.size,a:+c.a},v(a,d,e)))})}function p(a){return q.e(a)&&q.c(a).isFile()}
var x="process"in j,q=require("fs"),w=require("../node_modules/uupaa.sort.js/lib/Sort"),t="\u001b[33m",u="\u001b[0m";k.name="Watch";k.repository="https://github.com/uupaa/Watch.js";k.isFile=p;k.g=k.g;x&&(module.exports=k);j.Watch?j.Watch_=k:j.Watch=k;
